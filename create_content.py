from django.utils import timezone
from apps.users.models import User
from apps.content.models import Post, Category
import random

# Create 3 new verified users with Arabic names
new_users = [
    {
        'username': 'layla',
        'password': 'password123',
        'first_name': 'ليلى',
        'last_name': 'الحسيني',
        'email': 'layla@example.com',
        'is_verified': True
    },
    {
        'username': 'kareem',
        'password': 'password123',
        'first_name': 'كريم',
        'last_name': 'عثمان',
        'email': 'kareem@example.com',
        'is_verified': True
    },
    {
        'username': 'nour',
        'password': 'password123',
        'first_name': 'نور',
        'last_name': 'العلي',
        'email': 'nour@example.com',
        'is_verified': True
    },
]

created_users = []
for user_data in new_users:
    username = user_data['username']
    try:
        user = User.objects.get(username=username)
        print(f"User {username} already exists, updating...")
        user.first_name = user_data['first_name']
        user.last_name = user_data['last_name']
        user.email = user_data['email']
        user.is_verified = user_data['is_verified']
        user.save()
    except User.DoesNotExist:
        print(f"Creating new user: {username}")
        user = User.objects.create_user(
            username=username,
            email=user_data['email'],
            password=user_data['password'],
            first_name=user_data['first_name'],
            last_name=user_data['last_name'],
            is_verified=user_data['is_verified']
        )
    created_users.append(user)

# Get existing users (should be 5 total including the 3 we just created and 2 existing ones)
existing_users = list(User.objects.filter(username__in=['ahmed', 'salam']).order_by('-id')) + created_users
print(f"Working with {len(existing_users)} users:")
for user in existing_users:
    print(f"- {user.username}: {user.first_name} {user.last_name}")

# Get all categories
categories = list(Category.objects.all())

# Post content
posts_content = [
    "رابطة العالم الإسلامي عبر موقعها الرسمي على الإنترنت:\n\nنرحب بقرار الاتحاد الأوروبي رفع جميع العقوبات الاقتصادية المفروضة على الجمهورية العربية السورية.",
    
    "وزارة الاقتصاد والصناعة توقف العمل بالقرارين رقم 2266 و3836 المتضمنين فرض ضميمة على مادة الإسمنت المنتج في القطاعين العام والخاص",
    
    "غرفة تجارة دمشق عبر قناتها الرسمية على \"تلغرام\": نرحب بقرار الاتحاد الاوروبي برفع العقوبات الاقتصادية عن سوريا ونعتبره خطوة ايجابية نحو اعادة بناء جسور التعاون الاقتصادي والتجاري بين سوريا ودول الاتحاد الاوروبي",
    
    "وزير المالية محمد يسر برنية في منشور عبر لينكد إن:\n\n•⁠ ⁠صدر اليوم قرار تاريخي من الاتحاد الأوروبي برفع جميع العقوبات المفروضة على بلدي سوريا\n\n•⁠ ⁠هذا القرار يأتي ضمن سلسلة خطوات أوروبية لتخفيف العقوبات ويعكس اهتمام دول الاتحاد باستقرار سوريا وتعافيها ويُعد نجاحاً جديداً للدبلوماسية السورية\n\n•⁠ ⁠زارني الأسبوع الماضي وفد من المفوضية الأوروبية برئاسة بيتر فاغنر يرافقه مايكل أونماخت القائم بأعمال سفير الاتحاد الأوروبي في سوريا وأكدنا أهمية تعزيز العلاقات مع القارة الأوروبية\n\n•⁠ ⁠جرى خلال اللقاء بحث دعم الاتحاد الأوروبي للإصلاحات الاقتصادية والإدارية ومساهماته في الاستثمار وبناء القدرات داخل سوريا\n\n•⁠ ⁠نشكر الاتحاد الأوروبي ودوله الأعضاء ومؤسساته على هذا القرار الذي سيفتح آفاقاً واسعة للتعاون الاقتصادي ونقل المعرفة والخبرات\n\n\n•⁠ ⁠رفع العقوبات الأوروبية بالكامل اليوم يسرّع جهود بناء شراكة وتعاون سوري أوروبي قائم على المصالح المشتركة",
    
    "تعلن الشركة العامة لصناعة المنظفات الكيميائية /سار/ عن إجراء مزاد علني بالسرعة القصوى بالظرف المختوم لبيع كافة المواد الأولية والمنتجات الجاهزة الموجودة في المستودعات.\n\n#الجمهورية_العربية_السورية\n#وزارة_الاقتصاد_والصناعة\n#الإدارة_العامة_للصناعة",
    
    "أعلنت شركة DanAir الرومانية للطيران عن بدء رحلاتها إلى سورية بشكل رسمي اعتباراً من ١٥ حزيران القادم.\n\nوستُسيِّر الشركة رحلاتها من بوخارست، وكذلك من فرانكفورت وبرلين واستوكهولهم إلى دمشق عبر بوخارست، وقد أكَّد ممثل الشركة أن جميع الاجراءات المتعلقة بالرحلات إلى دمشق تتم وفق القوانين والاتفاقيات السارية بين البلدين.\n\nووفقاً لتأكيدات الشركة، يمكن للمسافرين السوريين اعتبارها شريكاً موثوقاً للنقل الجوي.",
    
    "وزارة التعليم العالي والبحث العلمي تمدد مواعيد استقبال طلبات الطلاب المنقطعين بسبب الثورة منذ العام 2011 للعودة إلى قيدهم السابق في الجامعات لغاية الخميس الواقع في 26/6/2025.\n\nالتفاصيل على الرابط الآتي:\nhttp://mohe.gov.sy/mohe/index.php?node=5632&nid=7602&First=0&Last=0&CurrentPage=0&src=all&\n\n#الجمهورية_العربية_السورية\n#وزارة_التعليم_العالي_والبحث_العلمي",
    
    "الجمهورية العربية السورية\nوزارة المالية\n\nتعميم رقم: 23/3/م\n\nإلى جميع الجهات العامة والخاصة\n\nتعلن وزارة المالية عن تمديد فترة تقديم التصريح الضريبي السنوي لعام 2025 حتى نهاية شهر أيلول 2025 بدلاً من نهاية شهر تموز. \n\nترفق الوثائق المحاسبية المؤيدة للتصريح وخاصة تقرير مدقق الحسابات والميزانية وحساب الأرباح والخسائر وتصريح الأرباح الحقيقية.\n\nتطبق غرامات التأخير القانونية على التصاريح المقدمة بعد التاريخ المذكور.\n\nدمشق في 21/5/2025\nوزير المالية\nمحمد يسر برنية",
    
    "وزارة التربية تعلن عن نتائج امتحانات الشهادة الثانوية العامة بفروعها كافة للعام الدراسي 2024-2025 على الرابط التالي:\n\nmoe.gov.sy/results\n\nوصلت نسبة النجاح في الشهادة الثانوية العامة بفرعها العلمي إلى 77.5% ونسبة النجاح في الفرع الأدبي بلغت 69.8% وفي الفرع المهني بلغت 65.3%.\n\nتهنئة لجميع الطلاب الناجحين وذويهم.",
    
    "الشركة السورية للاتصالات تعلن عن تخفيض أسعار خدمة الإنترنت عبر الـ ADSL بنسبة 20% على كافة الباقات اعتباراً من الأول من الشهر القادم ضمن خطة الشركة لتحسين جودة الخدمات وتخفيض التكاليف على المواطنين.\n\nلمزيد من التفاصيل زوروا موقعنا الرسمي: www.ste.gov.sy",
    
    "مصرف سورية المركزي يعلن عن تعديل سعر صرف الدولار الأمريكي مقابل الليرة السورية ليصبح 4500 ليرة للدولار الواحد اعتباراً من غد الأربعاء.\n\nيأتي هذا القرار ضمن سياسة المصرف لتخفيف الفجوة بين السعر الرسمي وسعر السوق الموازية، وسعياً لاستقرار سعر الصرف وكبح جماح التضخم.",
    
    "وزارة الكهرباء تعلن عن انتهاء أعمال صيانة محطة توليد حلب الحرارية وعودتها للخدمة بطاقة إنتاجية تصل إلى 500 ميغاواط. \n\nيأتي هذا الإنجاز ضمن جهود الوزارة لزيادة ساعات التغذية الكهربائية وتحسين واقع الكهرباء في مختلف المحافظات.",
    
    "وزارة الزراعة والإصلاح الزراعي تقرر تحديد سعر شراء القمح للموسم الزراعي 2025 بـ 2500 ليرة سورية للكيلوغرام الواحد، وفتح باب استلام المحصول من الفلاحين في كافة المحافظات اعتباراً من الأسبوع المقبل.\n\nوأكدت الوزارة استعدادها لاستلام الكميات المنتجة كافة وفق معايير الجودة المعتمدة، وتقديم التسهيلات اللازمة للفلاحين.",
    
    "مجلس الوزراء يقر مشروع قانون جديد للاستثمار يتضمن حزمة إعفاءات وتسهيلات غير مسبوقة لدعم المستثمرين المحليين والأجانب في مختلف القطاعات الإنتاجية.\n\nالقانون الجديد يشمل إعفاءات ضريبية تصل إلى 10 سنوات للمشاريع الاستراتيجية وتسهيل إجراءات نقل الأرباح وتوحيد نافذة الخدمات الاستثمارية.",
    
    "تعلن هيئة التخطيط والتعاون الدولي عن توقيع اتفاقية تعاون مع برنامج الأمم المتحدة الإنمائي UNDP لتنفيذ مشاريع إعادة تأهيل البنى التحتية في المناطق المتضررة بقيمة 150 مليون دولار.\n\nتستهدف المشاريع إعادة تأهيل شبكات المياه والصرف الصحي والمدارس والمشافي في ريف دمشق وحمص وحلب ودير الزور.",
    
    "وزارة النقل تعيد افتتاح مطار حلب الدولي لاستقبال الرحلات التجارية بعد الانتهاء من أعمال الصيانة والترميم. \n\nوبهذه المناسبة، أكد وزير النقل المهندس زهير خزيم الحرص على عودة مطار حلب إلى دوره الحيوي في خدمة المسافرين وتنشيط الحركة الاقتصادية في المدينة.",
    
    "مؤسسة التجارة الخارجية تعلن عن استيراد 200 ألف طن من الأرز و150 ألف طن من السكر لتعزيز المخزون الاستراتيجي من السلع الأساسية.\n\nوستطرح المؤسسة المواد المستوردة في الأسواق بأسعار مخفضة عن السوق بنسبة 15% لضبط الأسعار ودعم القدرة الشرائية للمواطنين."
]

# Create 18 new posts with categories, distributed among 5 users
# Make each user have 4 posts with different sequencing

user_index = 0
author_cycle = [0, 2, 4, 1, 3]  # mix up authors to avoid consecutive posts by same author

for i, content in enumerate(posts_content):
    # Select author based on the cycle
    author = existing_users[author_cycle[i % 5]]
    
    # Create post
    post = Post.objects.create(
        author=author,
        content=content,
        status='published',
        published_at=timezone.now()
    )
    
    # Select 2-3 random categories
    num_categories = random.randint(2, 3)
    selected_categories = random.sample(categories, num_categories)
    
    # Assign categories to post
    for category in selected_categories:
        post.categories.add(category)
        
    categories_str = ", ".join([cat.name for cat in selected_categories])
    print(f"Created post #{post.id} by {author.username} ({author.first_name}) with {num_categories} categories: {categories_str}")

print("\nFinished creating users and posts!") 